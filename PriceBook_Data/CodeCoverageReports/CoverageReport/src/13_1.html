<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\dev\PriceBook\PriceBook_Data\Item.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Microsoft.EntityFrameworkCore;

namespace PriceBook_Data
{
    public class Item
    {
        [Key, DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        public int Id { get; set; }

        [ForeignKey(&quot;Category&quot;)]
        public int CategoryId { get; set; }

        public Category Category { get; set; }

        [MaxLength(50)]
        public string Name { get; set; }


        [NotMapped]
        public bool Found { get; set; }

        public Item()
        {

        }

        public void LoadCategory()
        {
            Category cat = new Category(this.CategoryId);
            this.Category = cat;
        }

        public Item(int id)
        {
            ApplicationContext context = new ApplicationContext();
            Item item;
            // This is an example of eager loading.
            item = context.Item.Include(c =&gt; c.Category).FirstOrDefault(i =&gt; i.Id == id);
            
            
            if (item == null) Found = false;
            else
            {
                Found = true;
                this.Id = item.Id;
                this.Name = item.Name;
                this.CategoryId = item.CategoryId;
            }

        }
        
        public void Add()
        {
            using (ApplicationContext context = new ApplicationContext())
            {
                context.Item.Add(this);
                context.SaveChanges();
            }
        }

        public void SaveUpdate(bool doLoadCategory = false)
        {

            using (ApplicationContext context = new ApplicationContext())
            { 
                context.Item.Attach(this);
                if (context.Item.Any(i =&gt; i.Name == this.Name &amp;&amp; i.Id != this.Id))
                    throw new InvalidOperationException(&quot;Duplicate item name.&quot;);
                context.SaveChanges();
            }
            if (doLoadCategory) LoadCategory();

        }

        public void Delete()
        {
            using (ApplicationContext context = new ApplicationContext())
            {
                context.Item.Attach(this);
                context.Item.Remove(this);
                context.SaveChanges();
            }
        }

        
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[10,25,10,29,1],[10,30,10,34,1],[13,33,13,37,1],[13,38,13,42,1],[15,36,15,40,1],[15,41,15,45,1],[18,30,18,34,1],[18,35,18,39,1],[22,29,22,33,1],[22,34,22,38,1],[24,9,24,22,1],[25,9,25,10,1],[27,9,27,10,1],[30,9,30,10,1],[31,13,31,58,1],[32,13,32,33,1],[33,9,33,10,1],[35,9,35,28,1],[36,9,36,10,1],[37,13,37,67,1],[40,13,40,90,1],[43,13,43,30,1],[43,31,43,45,1],[45,13,45,14,1],[46,17,46,30,1],[47,17,47,35,1],[48,17,48,39,1],[49,17,49,51,1],[50,13,50,14,1],[52,9,52,10,1],[55,9,55,10,1],[56,20,56,73,1],[57,13,57,14,1],[58,17,58,40,1],[59,17,59,39,1],[60,13,60,14,1],[61,9,61,10,1],[64,9,64,10,1],[66,20,66,73,1],[67,13,67,14,1],[68,17,68,43,1],[69,17,69,83,1],[70,21,70,81,1],[71,17,71,39,1],[72,13,72,14,1],[73,13,73,32,1],[73,33,73,48,1],[75,9,75,10,1],[78,9,78,10,1],[79,20,79,73,1],[80,13,80,14,1],[81,17,81,43,1],[82,17,82,43,1],[83,17,83,39,1],[84,13,84,14,1],[85,9,85,10,1]]);
    </script>
  </body>
</html>